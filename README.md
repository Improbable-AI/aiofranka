# aiofranka

<div align="center">
  <img width="340" src="assets/image.png">
</div>

[![PyPI version](https://img.shields.io/pypi/v/aiofranka)](https://pypi.org/project/aiofranka/)  [![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT) 

This library is an asyncio-based client for controlling Franka robots using the official `pylibfranka` package as a control interface with Franka, and `mujoco` as kinematics/dynamics model. 



## Installation

1. Follow instructions here and install `pylibfranka`.
2. Install the package

    ```bash
    pip install aiofranka
    ```

## Quick Start

```bash 
python test.py 
```

which runs the following: 

```python
import asyncio 
import numpy as np 
from aiofranka import RobotInterface, FrankaController
import time 

async def main():
    robot = RobotInterface("172.16.0.2") 
    controller = FrankaController(robot)
    
    await controller.start()

    # tests the 1kHz connection with the robot 
    # prints average frequency / jitter 
    await controller.test_connection()

    # this moves to certain position by offline trajectory generated by Ruckig
    await controller.move([0, 0, 0.0, -1.57079, 0, 1.57079, -0.7853])

    # you can switch controllers / set gains at run-time 
    controller.switch("impedance")
    controller.kp = np.ones(7) * 80.0
    controller.kd = np.ones(7) * 4.0
    # this enforces 50Hz update rate for impedance controller target
    controller.set_freq(50) 
    for cnt in range(100): 
        delta = np.sin(cnt / 50.0 * np.pi) * 0.1
        init = controller.initial_qpos
        await controller.set("q_desired", delta + init)

    # switch to osc controller
    controller.switch("osc")
    controller.set_freq(50)  

    for cnt in range(100): 
        delta = np.sin(cnt / 50.0 * np.pi) * 0.1
        init = controller.initial_ee 

        desired_ee = np.eye(4) 
        desired_ee[:3, :3] = init[:3, :3]
        desired_ee[:3, 3] = init[:3, 3] + np.array([0, delta, 0])

        await controller.set("ee_desired", desired_ee)


if __name__ == "__main__":
    asyncio.run(main()) 
```